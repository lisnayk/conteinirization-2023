# Docker – Compose

## Що таке Docker Compose?

Docker Compose запускає багатоконтейнерні додатки на основі YAML-файлів. YAML-файл містить усі налаштування, необхідні для розгортання контейнерів. Docker Compose інтегрований із Docker Swarm та надає вказівки для створення й розгортання контейнерів. З Docker Compose кожен контейнер налаштовується для запуску на одному хості.

Docker Compose спрощує керування багатоконтейнерними додатками Docker. Якщо ви хочете глибше освоїти Docker Compose та його роль у життєвому циклі DevOps, [**курс "DevOps Engineering – від планування до продакшну"**](https://gfgcdn.com/tu/S8g/) надає практичні приклади керування багатоконтейнерними додатками.

## Чому Docker Compose?

Як було сказано раніше, реальний додаток має окремий контейнер для кожної своєї служби. І ми знаємо, що кожен контейнер потребує Dockerfile. Це означає, що нам доведеться створити, можливо, сотні Docker-файлів і потім окремо керувати кожним контейнером, що є громіздким процесом.

Отже, ми використовуємо docker-compose — інструмент, що допомагає визначати та запускати багатоконтейнерні додатки. За допомогою Docker Compose ви можете запускати та зупиняти служби, використовуючи YAML-файл. Docker Compose дозволяє запускати та зупиняти всі служби простими командами за допомогою одного YAML-файлу для кожної конфігурації.

На відміну від використання попередньо створеного образу з Docker Hub, який можна налаштувати за допомогою файлу docker-compose.yaml, якщо ви використовуєте власний образ, вам потрібно вказати його конфігурацію у окремому Dockerfile. Ось деякі з можливостей Docker Compose:

- Усі служби ізольовані та працюють на одному хості.
- Контейнери перезапускаються лише при зміні.
- Дані в об'ємах зберігаються при створенні нових контейнерів.
- Переміщення змінних та композиції між середовищами.
- Створюється віртуальна мережа для зручної взаємодії в межах середовищ.

**Переваги Docker Compose**

- Просте керування багатоконтейнерними додатками: Спрощує процес керування кількома контейнерами.
- Послідовність середовищ: Забезпечує узгодженість середовищ розробки, тестування та продакшну.
- Автоматизація: Легко налаштовує та зупиняє багатоконтейнерні середовища.
- Ефективне керування ресурсами: Підвищує продуктивність додатка та масштабованість.

**Недоліки Docker Compose**

- Обмежена масштабованість: Не підходить для великих і складних розгортань.
- Підтримка тільки одного хоста: Працює лише на одному хості.
- Базове балансування навантаження: Відсутні розширені функції балансування навантаження.
- Мінімальні можливості моніторингу: Немає вбудованих можливостей для моніторингу.


Давайте розглянемо, як використовувати docker-compose на простому проєкті.

У цьому проєкті ми створимо простий RESTful API, який повертатиме список фруктів. Для цього використовуватимемо Flask. А додаток на PHP запитуватиме цю службу та показуватиме її в браузері. Обидві служби працюватимуть у своїх контейнерах.

1. Створіть окрему директорію для всього проєкту командою:

    ```bash
    mkdir dockerComposeProject
    ```

2. Перейдіть у цю директорію:

    ```bash
    cd dockerComposeProject
    ```

### Крок 1: Створення API

Створимо кастомний образ, який використовуватиме Python для роботи з RESTful API. Потім службу буде налаштовано за допомогою Dockerfile.

1. Створіть підкаталог для служби під назвою `product` та перейдіть до нього:

    ```bash
    mkdir product
    cd product
    ```

### Крок 2: Створення Python файлу api.py

Нижче наведено Python-файл для створення виклику API.

```python
from flask import Flask
from flask_restful import Resource, Api

app = Flask(__name__)
api = Api(app)

class Fruits(Resource):
    def get(self):
        return {
            'fruits': ['Манго', 'Гранат', 'Апельсин', 'Лічі']
        }

api.add_resource(Fruits, '/')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=80, debug=True)
```

### Крок 3: Створення файлу `requirements.txt`

У цьому файлі ми вкажемо необхідні залежності для Python API:

```plaintext
flask
flask-restful
